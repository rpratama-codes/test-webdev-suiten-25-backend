datasource db {
  provider = "postgresql"
}

generator client {
  // Prisma New Generator
  provider               = "prisma-client"
  output                 = "generated"
  engineType             = "client"
  moduleFormat           = "esm"
  importFileExtension    = "js"
  generatedFileExtension = "ts"
}

enum UserRoles {
  system_user
  user
}

model Users {
  id                String    @id @default(uuid(7))
  first_name        String?
  last_name         String?
  email             String    @unique @db.Citext
  username          String    @unique @db.Citext
  verified          Boolean   @default(false)
  password          String?
  image             String?
  role              UserRoles
  google_account_id String?

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  oneTimeTokenSecrets OneTimeTokenSecrets[]

  @@index(google_account_id)
  @@map("users")
}

model OneTimeTokenSecrets {
  id         String   @id @default(uuid(7))
  user_id    String
  secret     String
  config     Json     @db.JsonB
  time_used  Int      @default(0)
  expired_at DateTime

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user Users? @relation(fields: [user_id], references: [id])

  @@index([user_id])
  @@map("one_time_token_secrets")
}

model WorkPositionNames {
  id   String @id @default(uuid(7))
  name String

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  workPositions WorkPositions[]

  @@map("work_position_name")
}

// An employee can have more than one position. 
model WorkPositions {
  id                    String @id @default(uuid(7))
  employee_id           String
  work_position_name_id String

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  employee           Employees         @relation(fields: [employee_id], references: [id], onDelete: Cascade)
  work_position_name WorkPositionNames @relation(fields: [work_position_name_id], references: [id])

  @@index([employee_id])
  @@index([work_position_name_id])
  @@map("work_positions")
}

model BankNames {
  id   String @id @default(uuid(7))
  name String

  employees Employees[]

  @@map("bank_names")
}

enum SalaryPaymentPeriode {
  daily
  weekly
  bi_weekly
  semi_monthly
  monthly
}

model Employees {
  id                     String                @id @default(uuid(7))
  name                   String
  phone_number           String?
  bank_account_number    String?
  bank_account_name      String?
  bank_name_id           String?
  salary                 Float                 @default(0) @db.DoublePrecision
  salary_daily           Float                 @default(0) @db.DoublePrecision
  salary_payment_periode SalaryPaymentPeriode?
  allowance_meal         Float                 @default(0) @db.DoublePrecision
  allowance_holiday      Float                 @default(0) @db.DoublePrecision
  overtime_rate          Float                 @default(0) @db.DoublePrecision
  overtime_holiday_rate  Float                 @default(0) @db.DoublePrecision

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  bank_name BankNames? @relation(fields: [bank_name_id], references: [id], onDelete: SetNull)

  workPositions   WorkPositions[]
  attendances     Attendance[]
  attendanceTimes AttendanceTimes[]

  @@index([bank_name_id])
  @@map("employees")
}

model Attendance {
  id             String   @id @default(uuid(7))
  employee_id    String
  date           DateTime @db.Date
  clock_out_time DateTime @db.Time()
  workingTime    String   @default("0+0")
  notes          String?

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  employee        Employees         @relation(fields: [employee_id], references: [id], onDelete: Cascade)
  attendanceTimes AttendanceTimes[]

  @@index([employee_id])
  @@map("attendance")
}

model AttendanceTimes {
  id            String @id @default(uuid(7))
  employee_id   String
  attendance_id String

  employee   Employees  @relation(fields: [employee_id], references: [id], onDelete: Cascade)
  attendance Attendance @relation(fields: [attendance_id], references: [id], onDelete: Cascade)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([employee_id])
  @@index([attendance_id])
  @@map("attendance_times")
}
